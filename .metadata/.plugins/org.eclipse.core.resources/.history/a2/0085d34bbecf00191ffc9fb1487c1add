import java.util.concurrent.Semaphore;

import clock.ClockInput;
import clock.ClockInput.UserInput;
import clock.ClockOutput;
import emulator.AlarmClockEmulator;

class UpdateClock implements Runnable{
	Semaphore sem;
	ClockOutput out;
	
	public UpdateClock(ClockOutput out, Semaphore sem) {
		this.sem = sem;
		this.out = out;
	}
	
	private int convertTime(long time) {
		
		String h = Integer.toString((int) time / (1000*3600));
		String m = Long.toString((time % (1000*3600)) / (1000*60));
		String s = Long.toString((time % (1000*60)) / (1000));
		System.out.println(h + ", " +  m + ", " + s);
		return Integer.parseInt(h + m + s);
	}
	
	public void run() {
		try {
			sem.acquire();
			long now = System.currentTimeMillis();
			out.displayTime(this.convertTime(now));
			Thread.sleep(1000 - (System.currentTimeMillis() - now));
		} catch (InterruptedException e) {
			System.out.println("Exception in thread: "+ e.getMessage());
		}
	}
	
}

public class ClockMain {

    public static void main(String[] args) throws InterruptedException {
        AlarmClockEmulator emulator = new AlarmClockEmulator();

        ClockInput  in  = emulator.getInput();
        ClockOutput out = emulator.getOutput();
        
        System.out.println(in);
        System.out.println(out);
        
        out.displayTime(150237);   // arbitrary time: just an example
       
        
        Semaphore sem = in.getSemaphore();
        
        Semaphore sem2 = new Semaphore(1);
        UpdateClock updateThread = new UpdateClock(out, sem2);
        Thread t = new Thread(updateThread);
        t.start();
        
        while (true) {
            sem.acquire();                        // wait for user input

            UserInput userInput = in.getUserInput();
            int choice = userInput.getChoice();
            int value = userInput.getValue();

            System.out.println("choice = " + choice + "  value=" + value);
        }
    }
}
